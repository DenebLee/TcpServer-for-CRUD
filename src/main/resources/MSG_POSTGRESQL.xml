<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.nanoit.db.MessageDAO">

    <!--    마이바티스 에서 insert, update, delte의 return 은 int-->

    <update id="createTable">
        CREATE TABLE IF NOT EXISTS simple_message
        (
            ID        BIGSERIAL PRIMARY KEY NOT NULL,
            SEND_TIME TIMESTAMP             NOT NULL,
            SENDER    VARCHAR(34)           NOT NULL,
            CONTENT   VARCHAR(200)          NOT NULL
        );
    </update>

    <update id="update" parameterType="kr.nanoit.model.message.MessageDto">
        UPDATE simple_message
        SET SENDER  = #{sender},
            CONTENT = #{content}
        WHERE ID = #{id}
    </update>

    <select id="selectById" parameterType="_long" resultType="kr.nanoit.model.message.MessageDto">
        <![CDATA[
        SELECT id, send_time, sender, content
        FROM simple_message
        WHERE ID = #{id}
        ]]>
    </select>

    <delete id="delete" parameterType="_long">
        DELETE
        from simple_message
        WHERE ID = #{id}
    </delete>
    <!-- useGenratedKeys : Returning Id를 처리할 것인지에 대한 프로퍼티. True로 설정해준다.-->
    <insert id="insert" parameterType="kr.nanoit.model.message.MessageDto" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO simple_message (send_time, sender, content)
        VALUES (#{send_time}, #{sender}, #{content})
    </insert>

    <select id="selectAll">
        SELECT *
        FROM simple_message;
    </select>
</mapper>

